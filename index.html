<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>P3 Reader • Jayden</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <style>
    :root { --bg:#0b1220; --panel:#111827; --card:#0f172a; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); }
    header { position: sticky; top: 0; z-index: 5; background: rgba(17,24,39,.92); backdrop-filter: blur(10px); border-bottom:1px solid rgba(148,163,184,.15); padding: 10px 12px; }
    .topbar { display:flex; gap:10px; align-items:center; justify-content:space-between; }
    .brand { font-weight:700; letter-spacing:.2px; font-size: 16px; }
    .badge { font-size:12px; color: var(--muted); }
    .tabs { display:flex; gap:8px; overflow:auto; padding: 10px 2px 2px; }
    .tab { flex:0 0 auto; border:1px solid rgba(148,163,184,.2); background: rgba(15,23,42,.7); color: var(--text); padding:8px 10px; border-radius: 999px; font-size: 13px; }
    .tab.active { border-color: rgba(34,197,94,.6); box-shadow: 0 0 0 2px rgba(34,197,94,.15) inset; }
    main { padding: 12px; max-width: 980px; margin: 0 auto; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .panel { background: rgba(17,24,39,.75); border:1px solid rgba(148,163,184,.15); border-radius: 16px; padding: 12px; }
    .panel h2 { margin: 0 0 8px; font-size: 16px; }
    .subtabs { display:flex; gap:8px; margin: 10px 0 12px; }
    .subtab { padding:8px 10px; border-radius: 12px; border:1px solid rgba(148,163,184,.2); background: rgba(15,23,42,.65); font-size: 13px; }
    .subtab.active { border-color: rgba(34,197,94,.55); }
    .card { background: rgba(15,23,42,.75); border:1px solid rgba(148,163,184,.15); border-radius: 16px; padding: 14px; }
    .card + .card { margin-top: 12px; }
    .muted { color: var(--muted); }
    .pill { display:inline-flex; gap:6px; align-items:center; padding:4px 10px; border-radius:999px; border:1px solid rgba(148,163,184,.2); color: var(--muted); font-size: 12px; }
    .kw { padding: 0 3px; border-bottom: 2px solid rgba(245,158,11,.8); cursor: pointer; }
    .kw:hover { background: rgba(245,158,11,.12); border-radius: 6px; }
    .btn { border:1px solid rgba(148,163,184,.25); background: rgba(2,6,23,.35); color: var(--text); padding: 10px 12px; border-radius: 12px; font-size: 14px; }
    .btn.primary { border-color: rgba(34,197,94,.5); background: rgba(34,197,94,.12); }
    .btn.danger { border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.12); }
    .btn.small { padding: 7px 10px; font-size: 13px; border-radius: 10px; }
    .btn:disabled { opacity:.55; }
    .grid2 { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 800px){ .grid2 { grid-template-columns: 1.15fr .85fr; } }
    .choices { display:flex; gap:8px; flex-wrap:wrap; margin-top: 8px; }
    .chip { border:1px solid rgba(148,163,184,.25); background: rgba(2,6,23,.25); padding: 8px 10px; border-radius: 12px; font-size: 13px; cursor:pointer; user-select:none; }
    .chip.sel { border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.12); }
    .hr { height: 1px; background: rgba(148,163,184,.15); margin: 12px 0; }
    .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 18px; background: rgba(17,24,39,.92); border:1px solid rgba(148,163,184,.22); padding: 10px 12px; border-radius: 12px; font-size: 13px; display:none; max-width: 92vw; }
    dialog { border:none; border-radius: 16px; padding: 0; width: min(560px, 92vw); background: rgba(15,23,42,.98); color: var(--text); }
    dialog::backdrop { background: rgba(0,0,0,.55); }
    .dlg { padding: 14px; }
    .dlg h3 { margin: 0 0 6px; font-size: 16px; }
    .dlg .close { float:right; }
    input, select { width: 100%; padding: 10px 12px; border-radius: 12px; border:1px solid rgba(148,163,184,.2); background: rgba(2,6,23,.3); color: var(--text); font-size: 14px; }
    label { font-size: 12px; color: var(--muted); display:block; margin: 10px 0 6px; }
    .score { font-weight:800; font-size: 22px; }
    .kpi { display:flex; gap:10px; flex-wrap: wrap; }
    .kpi .panel { flex:1 1 240px; }
  </style>
</head>
<body>
<header>
  <div class="topbar">
    <div>
      <div class="brand">P3 Reader <span class="badge">• bilingual • offline</span></div>
      <div class="badge" id="statusLine">Loading…</div>
    </div>
    <button class="btn small" id="toggleCN">中文: 开</button>
  </div>
  <div class="tabs" id="tabs"></div>
</header>

<main id="app"></main>

<dialog id="wordDialog">
  <div class="dlg">
    <button class="btn small close" onclick="document.getElementById('wordDialog').close()">Close</button>
    <h3 id="wdTitle">Word</h3>
    <div class="muted" id="wdPos"></div>
    <div class="hr"></div>
    <div id="wdBody"></div>
    <div class="hr"></div>
    <div class="row">
      <button class="btn primary" id="addWordBtn">⭐ Add to Word Bank</button>
      <button class="btn" onclick="document.getElementById('wordDialog').close()">OK</button>
    </div>
  </div>
</dialog>

<div class="toast" id="toast"></div>

<script src="app.js"></script>
</body>
</html>
